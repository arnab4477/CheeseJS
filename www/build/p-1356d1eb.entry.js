import{r as i,h as s}from"./p-4d97f5d8.js";import{f as t,g as e}from"./p-e0479af2.js";import"./p-5a92e793.js";const r=(i,s,t,e,r)=>{let n="",a="",o="";if(i===s&&t===e)return{square:i+t,piece:a,color:o};let h=i.charCodeAt(0),l=s.charCodeAt(0),p=parseInt(t),u=parseInt(e),d=h+1,f=h-1,g=p+1,b=p-1;const P="h".charCodeAt(0),m="a".charCodeAt(0);if(l>h&&u>p)for(;(d<=l&&d<=P||g<=u&&g<=8)&&(n=String.fromCharCode(d)+g.toString(),a=r[n[0]][n[1]],o=c(a),""===a);)d++,g++;else if(l>h&&u<p)for(;(d<=l&&d<=P||b>=u&&b>=1)&&(n=String.fromCharCode(d)+b.toString(),a=r[n[0]][n[1]],o=c(a),""===a);)d++,b--;else if(l<h&&u>p)for(;(f>=l&&f>=m||g<=u&&g<=8)&&(n=String.fromCharCode(f)+g.toString(),a=r[n[0]][n[1]],o=c(a),""===a);)f--,g++;else if(l<h&&u<p)for(;(f>=l&&f>=m||b>=u&&b>=1)&&(n=String.fromCharCode(f)+b.toString(),a=r[n[0]][n[1]],o=c(a),""===a);)f--,b--;return{square:n,piece:a,color:o}},n=(i,s,t,e)=>{let r="",n="",a="";if(i===s)return{square:t+i,piece:n,color:a};const o=parseInt(i),h=parseInt(s);let l=o+1,p=o-1;if(o<h)for(;l<=h&&(r=t+l.toString(),n=e[r[0]][r[1]],a=c(n),""===n);l++);else for(;p>=h&&(r=t+p.toString(),n=e[r[0]][r[1]],a=c(n),""===n);p--);return{square:r,piece:n,color:a}},a=(i,s,t,e)=>{let r="",n="",a="";if(i===s&&e)return{square:i+t,piece:n,color:a};let o=i.charCodeAt(0),h=s.charCodeAt(0),l=o+1,p=o-1;if(o<h)for(;l<=h&&(r=String.fromCharCode(l)+t,n=e[r[0]][r[1]],a=c(n),""===n);l++);else for(;p>=h&&(r=String.fromCharCode(p)+t,n=e[r[0]][r[1]],a=c(n),""===n);p--);return{square:r,piece:n,color:a}},o=(i,s)=>{const[t,e,r,n]=p(i,s),[a,o]=u(t,e,r,n);if(a===o&&1===a)return!0;if(t===r){if(1===Math.abs(parseInt(e)-parseInt(n)))return!0}else if(e===n&&1===Math.abs(t.charCodeAt(0)-r.charCodeAt(0)))return!0;return!1},h=(i,s,t,e,r)=>!!(t!==s&&("w"===s&&r.includes(i)||"b"===s&&e.includes(i))),l=(i,s,t,e)=>{const[r,n,a,o]=p(s,t);let h=JSON.parse(JSON.stringify(e));return h[r][n]="",h[a][o]=i,h},c=i=>""===i?"":i.toLowerCase()===i?"b":"w",p=(i,s)=>{const[t,e]=d(i),[r,n]=d(s);return[t,e,r,n]},u=(i,s,t,e)=>[Math.abs(i.charCodeAt(0)-t.charCodeAt(0)),Math.abs(parseInt(s)-parseInt(e))],d=i=>2!==i.length&&"number"!=typeof parseInt(i[1])?(console.error("Invalid square given"),[null,null]):[i[0],i[1]],f=(i,s,t,e,r)=>{let a=!1,l={square:"",piece:"",color:""};return"up"===e?l=n(s,"8",i,r):"down"===e&&(l=n(s,"1",i,r),"w"===t&&"K"===l.piece&&(l=n((parseInt(s)-2).toString(),"1",i,r)),"b"===t&&"k"===l.piece&&(l=n((parseInt(s)-2).toString(),"1",i,r))),!(!o(i+s,l.square)||(a=h(l.piece,t,l.color,["Q","R","K"],["q","r","k"]),!a))||(a=h(l.piece,t,l.color,["Q","R"],["q","r"]),!!a)},g=(i,s,t,e,r)=>{let n=!1,l={square:"",piece:"",color:""};return"left"===e?l=a(i,"a",s,r):"right"===e&&(l=a(i,"h",s,r)),!(!o(i+s,l.square)||(n=h(l.piece,t,l.color,["Q","R","K"],["q","r","k"]),!n))||(n=h(l.piece,t,l.color,["Q","R"],["q","r"]),!!n)},b=(i,s,t)=>s>8||s<1||i>"h".charCodeAt(0)||i<"a".charCodeAt(0)?"":t[String.fromCharCode(i)][s.toString()],P=(i,s,t,e,n)=>{let[a,l]=((i,s)=>{const[t,e]=d(i);let r=t.charCodeAt(0),n=parseInt(e);const a="h".charCodeAt(0),o="a".charCodeAt(0);if("right-up"===s)for(;r<a&&n<8;)r++,n++;else if("right-down"===s)for(;r<a&&n>1;)r++,n--;else if("left-up"===s)for(;r>o&&n<8;)r--,n++;else if("left-down"===s)for(;r>o&&n>1;)r--,n--;return[String.fromCharCode(r),n.toFixed()]})(i+s,e),c=!1,p={square:"",piece:"",color:""};if(p=r(i,a,s,l,n),o(i+s,p.square)){if(((i,s,t)=>"w"===i&&"p"===s&&("right-up"===t||"left-up"===t)||"b"===i&&"P"===s&&("right-down"===t||"left-down"===t))(t,p.piece,e))return!0;if(c=h(p.piece,t,p.color,["Q","B","K"],["q","b","k"]),c)return!0}return c=h(p.piece,t,p.color,["Q","B"],["q","b"]),!!c},m=(i,s,t)=>{const[e,r]=d(i);return!!(f(e,r,s,"up",t)||f(e,r,s,"down",t)||g(e,r,s,"right",t)||g(e,r,s,"left",t)||P(e,r,s,"right-up",t)||P(e,r,s,"right-down",t)||P(e,r,s,"left-up",t)||P(e,r,s,"left-down",t)||((i,s,t,e)=>{const r=i.charCodeAt(0),n=parseInt(s);return"w"===t?"n"===b(r+1,n+2,e)||"n"===b(r-1,n+2,e)||"n"===b(r+1,n-2,e)||"n"===b(r-1,n-2,e)||"n"===b(r+2,n+1,e)||"n"===b(r-2,n+1,e)||"n"===b(r+2,n-1,e)||"n"===b(r-2,n-1,e):"b"===t?"N"===b(r+1,n+2,e)||"N"===b(r-1,n+2,e)||"N"===b(r+1,n-2,e)||"N"===b(r-1,n-2,e)||"N"===b(r+2,n+1,e)||"N"===b(r-2,n+1,e)||"N"===b(r+2,n-1,e)||"N"===b(r-2,n-1,e):void 0})(e,r,s,t))};class w{constructor(){this.boardMap=t(),this.whitesTurn=!0,this.movingPiece="",this.movingPiecesOrigin="",this.movingPiecesDest="",this.movingPiecesColor="",this.canWhiteEnPassant=[!1,""],this.canBlackEnPassant=[!1,""],this.canWhiteCastleKingSide=!0,this.canWhiteCastleQueenSide=!0,this.canBlackCastleKingSide=!0,this.canBlackCastleQueenSide=!0,this.IsPromoting=!1,this.whiteKingsPosition="e1",this.blackKingsPosition="e8"}PromotePawn(i){const s=l(i,this.movingPiecesOrigin,this.movingPiecesDest,this.boardMap);this.boardMap=JSON.parse(JSON.stringify(s)),this.whitesTurn=!this.whitesTurn}newMove(){const i=l(this.movingPiece,this.movingPiecesOrigin,this.movingPiecesDest,this.boardMap);this.boardMap=JSON.parse(JSON.stringify(i)),this.whitesTurn=!this.whitesTurn}ValidateMove(i,s,t){let e=!1,r=!1,n=!1,a=!1;if(i===s)return{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a};let o=this.movingPiecesColor;if(this.movingPiecesColor=c(t),this.whitesTurn&&"w"!==this.movingPiecesColor)return{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a};if(!this.whitesTurn&&"b"!==this.movingPiecesColor)return{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a};if(this.IsPromoting)return{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a};switch(t){case"K":({isValid:e,isCastle:n}=this.validateKingMove(i,s,"w"));break;case"k":({isValid:e,isCastle:n}=this.validateKingMove(i,s,"b"));break;case"Q":e=this.validateQueenMove(i,s,"w");break;case"q":e=this.validateQueenMove(i,s,"b");break;case"R":e=this.validateRookMove(i,s,"w");break;case"r":e=this.validateRookMove(i,s,"b");break;case"B":e=this.validateBishopMove(i,s,"w");break;case"b":e=this.validateBishopMove(i,s,"b");break;case"N":e=this.validateKnightMove(i,s,"w");break;case"n":e=this.validateKnightMove(i,s,"b");break;case"P":({isValid:e,isEnPassant:r,isPromotion:a}=this.validatePawnMove(i,s,"w"));break;case"p":({isValid:e,isEnPassant:r,isPromotion:a}=this.validatePawnMove(i,s,"b"))}if(e){"K"===t?(this.whiteKingsPosition=s,this.canWhiteCastleKingSide=!1,this.canWhiteCastleQueenSide=!1):"k"===t&&(this.blackKingsPosition=s,this.canBlackCastleKingSide=!1,this.canBlackCastleQueenSide=!1);const o=JSON.parse(JSON.stringify(this.boardMap));return((i,s,t,e,r,n)=>{const a=l(i,s,t,n),o=c(i);return"w"===o?!m(e,"w",a):"b"===o?!m(r,"b",a):void 0})(t,i,s,this.whiteKingsPosition,this.blackKingsPosition,o)?n?("K"===t?(this.boardMap.e[1]="","g1"===s||"h1"===s?(this.boardMap.g[1]="K",this.boardMap.f[1]="R",this.boardMap.h[1]=""):"c1"!==s&&"a1"!==s||(this.boardMap.c[1]="K",this.boardMap.d[1]="R",this.boardMap.a[1]="")):"k"===t&&(this.boardMap.e[8]="","g8"===s||"h8"===s?(this.boardMap.g[8]="k",this.boardMap.f[8]="r",this.boardMap.h[8]=""):"c8"!==s&&"a8"!==s||(this.boardMap.c[8]="k",this.boardMap.d[8]="r",this.boardMap.a[8]="")),this.whitesTurn=!this.whitesTurn,{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a}):(a||(r&&("P"===t?this.boardMap[s[0]][(parseInt(s[1])-1).toString()]="":"p"===t&&(this.boardMap[s[0]][(parseInt(s[1])+1).toString()]="")),"P"!==t&&"p"!==t&&(this.canBlackEnPassant=[!1,""],this.canWhiteEnPassant=[!1,""]),this.movingPiece=t,this.movingPiecesOrigin=i,this.movingPiecesDest=s,this.newMove()),{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a}):{isValid:!1,isEnPassant:r,isCastle:n,isPromotion:a}}return this.movingPiecesColor=o,{isValid:e,isEnPassant:r,isCastle:n,isPromotion:a}}validatePawnMove(i,s,t){const e=p(i,s);let r=!1,a=!1,o=!1;if(e.includes(null))return console.log("invalid square input"),{isValid:r,isEnPassant:a,isPromotion:o};const[h,l,d,f]=e,[g,b]=u(h,l,d,f);if(g>1||b>2)return{isValid:r,isEnPassant:a,isPromotion:o};let P="";if(a=((i,s,t,e,r)=>"w"===e?"5"===s&&"6"===t&&"p"===r[i][s]:"b"===e?"4"===s&&"3"===t&&"P"===r[i][s]:void 0)(d,l,f,t,this.boardMap),o=((i,s)=>("8"===s||"1"===s)&&("w"===i&&"8"===s||"b"===i&&"1"===s))(t,f),"w"===t){if(2===b&&"2"!==l)return{isValid:r,isEnPassant:a,isPromotion:o};if(!(parseInt(f)>parseInt(l)))return{isValid:r,isEnPassant:a,isPromotion:o};if(g===b)return a&&this.canWhiteEnPassant[0]&&""===this.boardMap[d][f]&&d===this.canWhiteEnPassant[1]?(this.canWhiteEnPassant=[!1,""],r=!0,{isValid:r,isEnPassant:a,isPromotion:o}):"b"===c(this.boardMap[d][f])?(r=!0,{isValid:r,isEnPassant:a,isPromotion:o}):{isValid:r,isEnPassant:a,isPromotion:o};if(P=n(l,f,h,this.boardMap).color,""!==P)return{isValid:r,isEnPassant:a,isPromotion:o}}else if("b"===t){if(2===b&&"7"!==l)return{isValid:r,isEnPassant:a,isPromotion:o};if(!(parseInt(f)<parseInt(l)))return{isValid:r,isEnPassant:a,isPromotion:o};if(g===b)return a&&this.canBlackEnPassant[0]&&""===this.boardMap[d][f]&&d===this.canBlackEnPassant[1]?(this.canBlackEnPassant=[!1,""],r=!0,{isValid:r,isEnPassant:a,isPromotion:o}):"w"===c(this.boardMap[d][f])?(r=!0,{isValid:r,isEnPassant:a,isPromotion:o}):{isValid:r,isEnPassant:a,isPromotion:o};if(P=n(l,f,h,this.boardMap).color,""!==P)return{isValid:r,isEnPassant:a,isPromotion:o}}return 2===b?"w"===t?this.canBlackEnPassant=[!0,h]:"b"===t&&(this.canWhiteEnPassant=[!0,h]):(this.canWhiteEnPassant=[!1,""],this.canBlackEnPassant=[!1,""]),r=!0,{isValid:r,isEnPassant:a,isPromotion:o}}validateKnightMove(i,s,t){const e=p(i,s);if(e.includes(null))return console.log("invalid square input"),!1;const[r,n,a,o]=e,[h,l]=u(r,n,a,o);return(1===h&&2===l||2===h&&1===l)&&t!==c(this.boardMap[a][o])}validateQueenMove(i,s,t){const e=this.validateRookMove(i,s,t),r=this.validateBishopMove(i,s,t);return!(!e&&!r)}validateKingMove(i,s,t){let e=!1;const r=p(i,s),[n,a,o,h]=r,[l,c]=u(n,a,o,h),d=((i,s,t,e,r,n,a,o)=>{if("w"===t){if("e1"!==i||"g1"!==s&&"h1"!==s&&"c1"!==s&&"a1"!==s||"R"!==e.h[1]&&"R"!==e.a[1])return!1;if("g1"===s||"h1"===s){if(!this.canWhiteCastleKingSide)return!1;if(""!==e.f[1]||""!==e.g[1])return!1;const i=m("f1","w",e),s=m("g1","w",e);return!i&&!s}if("c1"===s||"a1"===s){if(!n)return!1;if(""!==e.d[1]||""!==e.c[1])return!1;const i=m("d1","w",e),s=m("c1","w",e);return!i&&!s}}else if("b"===t){if("e8"!==i||"g8"!==s&&"h8"!==s&&"c8"!==s&&"a8"!==s||"r"!==e.h[8]&&"r"!==e.a[8])return!1;if("g8"===s||"h8"===s){if(!a)return!1;if(""!==e.f[8]||""!==e.g[8])return!1;const i=m("f8","b",e),s=m("g8","b",e);return!i&&!s}if("c8"===s||"a8"===s){if(!o)return!1;if(""!==e.d[8]||""!==e.c[8])return!1;const i=m("d8","b",e),s=m("c8","b",e);return!i&&!s}}})(i,s,t,this.boardMap,0,this.canWhiteCastleQueenSide,this.canBlackCastleKingSide,this.canBlackCastleQueenSide);return c>1?{isValid:e,isCastle:d}:l>1?d?(e=!0,{isValid:e,isCastle:d}):{isValid:e,isCastle:d}:(e=this.validateQueenMove(i,s,t),e&&m(s,t,this.boardMap)?(e=!1,{isValid:e,isCastle:d}):{isValid:e,isCastle:d})}validateBishopMove(i,s,t){const e=p(i,s);if(e.includes(null))return console.log("invalid square input"),!1;const[n,a,o,h]=e,[l,c]=u(n,a,o,h);if(l!==c)return!1;const d=r(n,o,a,h,this.boardMap);return t!==d.color&&(""===d.color||d.color===t||d.square===s)}validateRookMove(i,s,t){const e=p(i,s);if(e.includes(null))return console.log("invalid square input"),!1;const[r,o,h,l]=e;if(r!==h&&o!==l)return!1;if(o===l){const i=a(r,h,o,this.boardMap);if(t===i.color)return!1;if(""!==i.color&&i.color!==t&&i.square!==s)return!1}else if(r===h){const i=n(o,l,r,this.boardMap);if(t===i.color)return!1;if(""!==i.color&&i.color!==t&&i.square!==s)return!1}return"a1"===i&&(this.canWhiteCastleQueenSide=!1),"h1"===i&&(this.canWhiteCastleKingSide=!1),"a8"===i&&(this.canBlackCastleQueenSide=!1),"h8"===i&&(this.canBlackCastleKingSide=!1),!0}}const v=class{constructor(s){i(this,s),this.validator=new w,this.light="white",this.dark="black"}componentDidLoad(){this.analysisBoardContainer.innerHTML=e(this.light,this.dark,"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR");const i=this.analysisBoardContainer.querySelectorAll(".piece"),s=this.analysisBoardContainer.querySelectorAll(".square");i.forEach((i=>{i.addEventListener("dragstart",(()=>{setTimeout((()=>{i.classList.add("dragging","invisible")}),0)})),i.addEventListener("dragend",(()=>{i.classList.remove("dragging","invisible")}))})),s.forEach((i=>{i.addEventListener("dragover",(i=>{i.preventDefault()})),i.addEventListener("drop",(s=>{s.preventDefault();const t=this.analysisBoardContainer.querySelector(".dragging"),e=t.parentElement.id,r=i.id,n=t.id,{isValid:a,isEnPassant:o,isCastle:h,isPromotion:l}=this.validator.ValidateMove(e,r,n);if(a){if(o)return((i,s,t)=>{if("w"===c(s)){const s=i[0]+(parseInt(i[1])-1).toString();return t.querySelector(`#${s}`)}if("b"===c(s)){const s=i[0]+(parseInt(i[1])+1).toString();return t.querySelector(`#${s}`)}})(r,n,this.analysisBoardContainer).innerHTML="",void i.appendChild(t);if(h&&("K"===n||"k"===n)){const[i,s,e,a]=((i,s,t)=>{let e,r,n,a;return"K"===i?(e=t.querySelector("#e1"),"g1"===s||"h1"===s?(r=t.querySelector("#g1"),n=t.querySelector("#h1"),a=t.querySelector("#f1")):"c1"!==s&&"a1"!==s||(r=t.querySelector("#c1"),n=t.querySelector("#a1"),a=t.querySelector("#d1"))):"k"===i&&(e=t.querySelector("#e8"),"g8"===s||"h8"===s?(r=t.querySelector("#g8"),n=t.querySelector("#h8"),a=t.querySelector("#f8")):"c8"!==s&&"a8"!==s||(r=t.querySelector("#c8"),n=t.querySelector("#a8"),a=t.querySelector("#d8"))),[e,r,n,a]})(n,r,this.analysisBoardContainer);i.innerHTML="",s.appendChild(t);const o=e.firstElementChild;return e.innerHTML="",void a.appendChild(o)}if(l){this.validator.IsPromoting=!0,t.remove();const s=r[1],e=i.parentElement;let a,o,h="";"p"===n&&(h=(parseInt(r[1])+3).toString(),a=this.analysisBoardContainer.querySelector(`#${r[0]+h}`),o=a.parentElement);const l=(i=>{const s=document.createElement("div");return"8"===i?(s.innerHTML='<div class=\'promotion-list\'>\n       <img id="Q" alt=\'white queen\' class="piece promoting-piece" src=../assets/WQ.svg.png>\n       <img id="R" alt=\'white rook\' class="piece promoting-piece" src=../assets/WR.svg.png>\n       <img id="B" alt=\'white bishop\' class="piece promoting-piece" src=../assets/WB.svg.png>\n       <img id="N" alt=\'white knight\' class="piece promoting-piece" src=../assets/WN.svg.png>\n     </div>',s.firstElementChild):"1"===i?(s.innerHTML='<div class=\'promotion-list\'>\n      <img id="n" alt=\'black knight\' class="piece promoting-piece" src=../assets/bn.svg.png>\n      <img id="b" alt=\'black bishop\' class="piece promoting-piece" src=../assets/bb.svg.png>\n      <img id="r" alt=\'black rook\' class="piece promoting-piece" src=../assets/br.svg.png>\n      <img id="q" alt=\'black queen\' class="piece promoting-piece" src=../assets/bq.svg.png>\n     </div>',s.firstElementChild):void 0})(s);return"P"===n?e.replaceChild(l,i):o.replaceChild(l,a),void l.addEventListener("click",(s=>{const t=s.target;t.classList.remove("promoting-piece"),t.setAttribute("draggable","true"),t.addEventListener("dragstart",(()=>{setTimeout((()=>{t.classList.add("dragging","invisible")}),0)})),t.addEventListener("dragend",(()=>{t.classList.remove("dragging","invisible")})),i.innerHTML="",i.appendChild(t),"P"===n?e.replaceChild(i,l):o.replaceChild(a,l),this.validator.PromotePawn(t.id),this.validator.IsPromoting=!1}))}i.innerHTML="",i.appendChild(t)}}))}))}render(){return s("div",{ref:i=>this.analysisBoardContainer=i,id:"analysis-board-container"})}};v.style="#analysis-board-container{position:relative;width:400px;height:400px;border:1px solid black}.row{display:flex;flex-direction:row;width:100%;height:50px}.promotion-list{display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;height:200px;width:50px}.square{width:50px;height:50px;border:0.1px black}.list-squares{width:50px;height:50px;border:0.1px black;background-color:lightgray}.piece{display:flex;justify-content:center;align-items:center;touch-action:none;cursor:grab;cursor:move}.promoting-piece{background-color:gray}.piece:active{cursor:grabbing}.invisible{display:none}@media (max-width: 550px){#analysis-board-container{width:280px;height:280px}.row{height:35px}.square{width:35px;height:35px}}";export{v as analysis_board}