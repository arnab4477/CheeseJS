import{r as i,h as s}from"./p-897da960.js";import{p as t,f as r,g as e}from"./p-4eddcdac.js";import"./p-5a92e793.js";const n=(i,s,t,r,e)=>{let n="",a="",o="";if(i===s&&t===r)return{square:i+t,piece:a,color:o};let h=i.charCodeAt(0),l=s.charCodeAt(0),c=parseInt(t),u=parseInt(r),p=h+1,g=h-1,f=c+1,P=c-1;const b="h".charCodeAt(0),m="a".charCodeAt(0);if(l>h&&u>c)for(;(p<=l&&p<=b||f<=u&&f<=8)&&(n=String.fromCharCode(p)+f.toString(),a=e[n[0]][n[1]],o=d(a),""===a);)p++,f++;else if(l>h&&u<c)for(;(p<=l&&p<=b||P>=u&&P>=1)&&(n=String.fromCharCode(p)+P.toString(),a=e[n[0]][n[1]],o=d(a),""===a);)p++,P--;else if(l<h&&u>c)for(;(g>=l&&g>=m||f<=u&&f<=8)&&(n=String.fromCharCode(g)+f.toString(),a=e[n[0]][n[1]],o=d(a),""===a);)g--,f++;else if(l<h&&u<c)for(;(g>=l&&g>=m||P>=u&&P>=1)&&(n=String.fromCharCode(g)+P.toString(),a=e[n[0]][n[1]],o=d(a),""===a);)g--,P--;return{square:n,piece:a,color:o}},a=(i,s,t,r)=>{let e="",n="",a="";if(i===s)return{square:t+i,piece:n,color:a};const o=parseInt(i),h=parseInt(s);let l=o+1,c=o-1;if(o<h)for(;l<=h&&(e=t+l.toString(),n=r[e[0]][e[1]],a=d(n),""===n);l++);else for(;c>=h&&(e=t+c.toString(),n=r[e[0]][e[1]],a=d(n),""===n);c--);return{square:e,piece:n,color:a}},o=(i,s,t,r)=>{let e="",n="",a="";if(i===s&&r)return{square:i+t,piece:n,color:a};let o=i.charCodeAt(0),h=s.charCodeAt(0),l=o+1,c=o-1;if(o<h)for(;l<=h&&(e=String.fromCharCode(l)+t,n=r[e[0]][e[1]],a=d(n),""===n);l++);else for(;c>=h&&(e=String.fromCharCode(c)+t,n=r[e[0]][e[1]],a=d(n),""===n);c--);return{square:e,piece:n,color:a}},h=(i,s)=>{const[t,r,e,n]=u(i,s),[a,o]=p(t,r,e,n);if(a===o&&1===a)return!0;if(t===e){if(1===Math.abs(parseInt(r)-parseInt(n)))return!0}else if(r===n&&1===Math.abs(t.charCodeAt(0)-e.charCodeAt(0)))return!0;return!1},l=(i,s,t,r,e)=>!!(t!==s&&("w"===s&&e.includes(i)||"b"===s&&r.includes(i))),c=(i,s,t,r)=>{const[e,n,a,o]=u(s,t);let h=JSON.parse(JSON.stringify(r));return h[e][n]="",h[a][o]=i,h},d=i=>""===i?"":i.toLowerCase()===i?"b":"w",u=(i,s)=>{const[t,r]=g(i),[e,n]=g(s);return[t,r,e,n]},p=(i,s,t,r)=>[Math.abs(i.charCodeAt(0)-t.charCodeAt(0)),Math.abs(parseInt(s)-parseInt(r))],g=i=>2!==i.length&&"number"!=typeof parseInt(i[1])?(console.error("Invalid square given"),[null,null]):[i[0],i[1]],f=(i,s,t,r,e)=>{let n=!1,o={square:"",piece:"",color:""};return"up"===r?o=a(s,"8",i,e):"down"===r&&(o=a(s,"1",i,e),"w"===t&&"K"===o.piece&&(o=a((parseInt(s)-2).toString(),"1",i,e)),"b"===t&&"k"===o.piece&&(o=a((parseInt(s)-2).toString(),"1",i,e))),!(!h(i+s,o.square)||(n=l(o.piece,t,o.color,["Q","R","K"],["q","r","k"]),!n))||(n=l(o.piece,t,o.color,["Q","R"],["q","r"]),!!n)},P=(i,s,t,r,e)=>{let n=!1,a={square:"",piece:"",color:""};return"left"===r?a=o(i,"a",s,e):"right"===r&&(a=o(i,"h",s,e)),!(!h(i+s,a.square)||(n=l(a.piece,t,a.color,["Q","R","K"],["q","r","k"]),!n))||(n=l(a.piece,t,a.color,["Q","R"],["q","r"]),!!n)},b=(i,s,t)=>s>8||s<1||i>"h".charCodeAt(0)||i<"a".charCodeAt(0)?"":t[String.fromCharCode(i)][s.toString()],m=(i,s,t,r,e)=>{let[a,o]=((i,s)=>{const[t,r]=g(i);let e=t.charCodeAt(0),n=parseInt(r);const a="h".charCodeAt(0),o="a".charCodeAt(0);if("right-up"===s)for(;e<a&&n<8;)e++,n++;else if("right-down"===s)for(;e<a&&n>1;)e++,n--;else if("left-up"===s)for(;e>o&&n<8;)e--,n++;else if("left-down"===s)for(;e>o&&n>1;)e--,n--;return[String.fromCharCode(e),n.toFixed()]})(i+s,r),c=!1,d={square:"",piece:"",color:""};if(d=n(i,a,s,o,e),h(i+s,d.square)){if(((i,s,t)=>"w"===i&&"p"===s&&("right-up"===t||"left-up"===t)||"b"===i&&"P"===s&&("right-down"===t||"left-down"===t))(t,d.piece,r))return!0;if(c=l(d.piece,t,d.color,["Q","B","K"],["q","b","k"]),c)return!0}return c=l(d.piece,t,d.color,["Q","B"],["q","b"]),!!c},w=(i,s,t)=>{const[r,e]=g(i);return!!(f(r,e,s,"up",t)||f(r,e,s,"down",t)||P(r,e,s,"right",t)||P(r,e,s,"left",t)||m(r,e,s,"right-up",t)||m(r,e,s,"right-down",t)||m(r,e,s,"left-up",t)||m(r,e,s,"left-down",t)||((i,s,t,r)=>{const e=i.charCodeAt(0),n=parseInt(s);return"w"===t?"n"===b(e+1,n+2,r)||"n"===b(e-1,n+2,r)||"n"===b(e+1,n-2,r)||"n"===b(e-1,n-2,r)||"n"===b(e+2,n+1,r)||"n"===b(e-2,n+1,r)||"n"===b(e+2,n-1,r)||"n"===b(e-2,n-1,r):"b"===t?"N"===b(e+1,n+2,r)||"N"===b(e-1,n+2,r)||"N"===b(e+1,n-2,r)||"N"===b(e-1,n-2,r)||"N"===b(e+2,n+1,r)||"N"===b(e-2,n+1,r)||"N"===b(e+2,n-1,r)||"N"===b(e-2,n-1,r):void 0})(r,e,s,t))};class v{constructor(){this.boardMap=r(),this.whitesTurn=!0,this.movingPiece="",this.movingPiecesOrigin="",this.movingPiecesDest="",this.movingPiecesColor="",this.canWhiteEnPassant=[!1,""],this.canBlackEnPassant=[!1,""],this.canWhiteCastleKingSide=!0,this.canWhiteCastleQueenSide=!0,this.canBlackCastleKingSide=!0,this.canBlackCastleQueenSide=!0,this.IsPromoting=!1,this.whiteKingsPosition="e1",this.blackKingsPosition="e8"}PromotePawn(i){const s=c(i,this.movingPiecesOrigin,this.movingPiecesDest,this.boardMap);this.boardMap=JSON.parse(JSON.stringify(s)),this.whitesTurn=!this.whitesTurn}newMove(){const i=c(this.movingPiece,this.movingPiecesOrigin,this.movingPiecesDest,this.boardMap);this.boardMap=JSON.parse(JSON.stringify(i)),this.whitesTurn=!this.whitesTurn}ValidateMove(i,s,t){let r=!1,e=!1,n=!1,a=!1;if(i===s)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};let o=this.movingPiecesColor;if(this.movingPiecesColor=d(t),this.whitesTurn&&"w"!==this.movingPiecesColor)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};if(!this.whitesTurn&&"b"!==this.movingPiecesColor)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};if(this.IsPromoting)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};switch(t){case"K":({isValid:r,isCastle:n}=this.validateKingMove(i,s,"w"));break;case"k":({isValid:r,isCastle:n}=this.validateKingMove(i,s,"b"));break;case"Q":r=this.validateQueenMove(i,s,"w");break;case"q":r=this.validateQueenMove(i,s,"b");break;case"R":r=this.validateRookMove(i,s,"w");break;case"r":r=this.validateRookMove(i,s,"b");break;case"B":r=this.validateBishopMove(i,s,"w");break;case"b":r=this.validateBishopMove(i,s,"b");break;case"N":r=this.validateKnightMove(i,s,"w");break;case"n":r=this.validateKnightMove(i,s,"b");break;case"P":({isValid:r,isEnPassant:e,isPromotion:a}=this.validatePawnMove(i,s,"w"));break;case"p":({isValid:r,isEnPassant:e,isPromotion:a}=this.validatePawnMove(i,s,"b"))}if(r){"K"===t?(this.whiteKingsPosition=s,this.canWhiteCastleKingSide=!1,this.canWhiteCastleQueenSide=!1):"k"===t&&(this.blackKingsPosition=s,this.canBlackCastleKingSide=!1,this.canBlackCastleQueenSide=!1);const o=JSON.parse(JSON.stringify(this.boardMap)),h=((i,s,t,r,e,n)=>{const a=c(i,s,t,n),o=d(i);return"w"===o?!w(r,"w",a):"b"===o?!w(e,"b",a):void 0})(t,i,s,this.whiteKingsPosition,this.blackKingsPosition,o);return h?n?("K"===t?(this.boardMap.e[1]="","g1"===s||"h1"===s?(this.boardMap.g[1]="K",this.boardMap.f[1]="R",this.boardMap.h[1]=""):"c1"!==s&&"a1"!==s||(this.boardMap.c[1]="K",this.boardMap.d[1]="R",this.boardMap.a[1]="")):"k"===t&&(this.boardMap.e[8]="","g8"===s||"h8"===s?(this.boardMap.g[8]="k",this.boardMap.f[8]="r",this.boardMap.h[8]=""):"c8"!==s&&"a8"!==s||(this.boardMap.c[8]="k",this.boardMap.d[8]="r",this.boardMap.a[8]="")),this.whitesTurn=!this.whitesTurn,{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a}):(a||(e&&("P"===t?this.boardMap[s[0]][(parseInt(s[1])-1).toString()]="":"p"===t&&(this.boardMap[s[0]][(parseInt(s[1])+1).toString()]="")),"P"!==t&&"p"!==t&&(this.canBlackEnPassant=[!1,""],this.canWhiteEnPassant=[!1,""]),this.movingPiece=t,this.movingPiecesOrigin=i,this.movingPiecesDest=s,this.newMove()),{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a}):{isValid:!1,isEnPassant:e,isCastle:n,isPromotion:a}}return this.movingPiecesColor=o,{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a}}validatePawnMove(i,s,t){const r=u(i,s);let e=!1,n=!1,o=!1;if(r.includes(null))return console.log("invalid square input"),{isValid:e,isEnPassant:n,isPromotion:o};const[h,l,c,g]=r,[f,P]=p(h,l,c,g);if(f>1||P>2)return{isValid:e,isEnPassant:n,isPromotion:o};let b="";if(n=((i,s,t,r,e)=>"w"===r?"5"===s&&"6"===t&&"p"===e[i][s]:"b"===r?"4"===s&&"3"===t&&"P"===e[i][s]:void 0)(c,l,g,t,this.boardMap),o=((i,s)=>("8"===s||"1"===s)&&("w"===i&&"8"===s||"b"===i&&"1"===s))(t,g),"w"===t){if(2===P&&"2"!==l)return{isValid:e,isEnPassant:n,isPromotion:o};if(!(parseInt(g)>parseInt(l)))return{isValid:e,isEnPassant:n,isPromotion:o};if(f===P)return n&&this.canWhiteEnPassant[0]&&""===this.boardMap[c][g]&&c===this.canWhiteEnPassant[1]?(this.canWhiteEnPassant=[!1,""],e=!0,{isValid:e,isEnPassant:n,isPromotion:o}):"b"===d(this.boardMap[c][g])?(e=!0,{isValid:e,isEnPassant:n,isPromotion:o}):{isValid:e,isEnPassant:n,isPromotion:o};if(b=a(l,g,h,this.boardMap).color,""!==b)return{isValid:e,isEnPassant:n,isPromotion:o}}else if("b"===t){if(2===P&&"7"!==l)return{isValid:e,isEnPassant:n,isPromotion:o};if(!(parseInt(g)<parseInt(l)))return{isValid:e,isEnPassant:n,isPromotion:o};if(f===P)return n&&this.canBlackEnPassant[0]&&""===this.boardMap[c][g]&&c===this.canBlackEnPassant[1]?(this.canBlackEnPassant=[!1,""],e=!0,{isValid:e,isEnPassant:n,isPromotion:o}):"w"===d(this.boardMap[c][g])?(e=!0,{isValid:e,isEnPassant:n,isPromotion:o}):{isValid:e,isEnPassant:n,isPromotion:o};if(b=a(l,g,h,this.boardMap).color,""!==b)return{isValid:e,isEnPassant:n,isPromotion:o}}return 2===P?"w"===t?this.canBlackEnPassant=[!0,h]:"b"===t&&(this.canWhiteEnPassant=[!0,h]):(this.canWhiteEnPassant=[!1,""],this.canBlackEnPassant=[!1,""]),e=!0,{isValid:e,isEnPassant:n,isPromotion:o}}validateKnightMove(i,s,t){const r=u(i,s);if(r.includes(null))return console.log("invalid square input"),!1;const[e,n,a,o]=r,[h,l]=p(e,n,a,o);return(1===h&&2===l||2===h&&1===l)&&t!==d(this.boardMap[a][o])}validateQueenMove(i,s,t){const r=this.validateRookMove(i,s,t),e=this.validateBishopMove(i,s,t);return!(!r&&!e)}validateKingMove(i,s,t){let r=!1;const e=u(i,s),[n,a,o,h]=e,[l,c]=p(n,a,o,h),d=((i,s,t,r,e,n,a,o)=>{if("w"===t){if("e1"!==i||"g1"!==s&&"h1"!==s&&"c1"!==s&&"a1"!==s||"R"!==r.h[1]&&"R"!==r.a[1])return!1;if("g1"===s||"h1"===s){if(!this.canWhiteCastleKingSide)return!1;if(""!==r.f[1]||""!==r.g[1])return!1;const i=w("f1","w",r),s=w("g1","w",r);return!i&&!s}if("c1"===s||"a1"===s){if(!n)return!1;if(""!==r.d[1]||""!==r.c[1])return!1;const i=w("d1","w",r),s=w("c1","w",r);return!i&&!s}}else if("b"===t){if("e8"!==i||"g8"!==s&&"h8"!==s&&"c8"!==s&&"a8"!==s||"r"!==r.h[8]&&"r"!==r.a[8])return!1;if("g8"===s||"h8"===s){if(!a)return!1;if(""!==r.f[8]||""!==r.g[8])return!1;const i=w("f8","b",r),s=w("g8","b",r);return!i&&!s}if("c8"===s||"a8"===s){if(!o)return!1;if(""!==r.d[8]||""!==r.c[8])return!1;const i=w("d8","b",r),s=w("c8","b",r);return!i&&!s}}})(i,s,t,this.boardMap,0,this.canWhiteCastleQueenSide,this.canBlackCastleKingSide,this.canBlackCastleQueenSide);return c>1?{isValid:r,isCastle:d}:l>1?d?(r=!0,{isValid:r,isCastle:d}):{isValid:r,isCastle:d}:(r=this.validateQueenMove(i,s,t),r&&w(s,t,this.boardMap)?(r=!1,{isValid:r,isCastle:d}):{isValid:r,isCastle:d})}validateBishopMove(i,s,t){const r=u(i,s);if(r.includes(null))return console.log("invalid square input"),!1;const[e,a,o,h]=r,[l,c]=p(e,a,o,h);if(l!==c)return!1;const d=n(e,o,a,h,this.boardMap);return t!==d.color&&(""===d.color||d.color===t||d.square===s)}validateRookMove(i,s,t){const r=u(i,s);if(r.includes(null))return console.log("invalid square input"),!1;const[e,n,h,l]=r;if(e!==h&&n!==l)return!1;if(n===l){const i=o(e,h,n,this.boardMap);if(t===i.color)return!1;if(""!==i.color&&i.color!==t&&i.square!==s)return!1}else if(e===h){const i=a(n,l,e,this.boardMap);if(t===i.color)return!1;if(""!==i.color&&i.color!==t&&i.square!==s)return!1}return"a1"===i&&(this.canWhiteCastleQueenSide=!1),"h1"===i&&(this.canWhiteCastleKingSide=!1),"a8"===i&&(this.canBlackCastleQueenSide=!1),"h8"===i&&(this.canBlackCastleKingSide=!1),!0}}const k=i=>{setTimeout((()=>{i.classList.add("dragging","invisible")}),0)},V=i=>{i.classList.remove("dragging","invisible")},q=(i,s,r)=>{const e=s.querySelector(".dragging"),n=e.parentElement.id,a=i.id,o=e.id,{isValid:h,isEnPassant:l,isCastle:c,isPromotion:u}=r.ValidateMove(n,a,o);if(h){if(l){const t=((i,s,t)=>{if("w"===d(s)){const s=i[0]+(parseInt(i[1])-1).toString();return t.querySelector(`#${s}`)}if("b"===d(s)){const s=i[0]+(parseInt(i[1])+1).toString();return t.querySelector(`#${s}`)}})(a,o,s);return t.innerHTML="",i.appendChild(e),void e.classList.remove("dragging")}if(c&&("K"===o||"k"===o)){const[i,t,r,n]=((i,s,t)=>{let r,e,n,a;return"K"===i?(r=t.querySelector("#e1"),"g1"===s||"h1"===s?(e=t.querySelector("#g1"),n=t.querySelector("#h1"),a=t.querySelector("#f1")):"c1"!==s&&"a1"!==s||(e=t.querySelector("#c1"),n=t.querySelector("#a1"),a=t.querySelector("#d1"))):"k"===i&&(r=t.querySelector("#e8"),"g8"===s||"h8"===s?(e=t.querySelector("#g8"),n=t.querySelector("#h8"),a=t.querySelector("#f8")):"c8"!==s&&"a8"!==s||(e=t.querySelector("#c8"),n=t.querySelector("#a8"),a=t.querySelector("#d8"))),[r,e,n,a]})(o,a,s);i.innerHTML="",t.appendChild(e);const h=r.firstElementChild;return r.innerHTML="",n.appendChild(h),void e.classList.remove("dragging")}if(u){r.IsPromoting=!0,e.remove();const n=a[1],h=i.parentElement;let l,c,d="";"p"===o&&(d=(parseInt(a[1])+3).toString(),l=s.querySelector(`#${a[0]+d}`),c=l.parentElement);const u=(i=>{const s=`<div class='promotion-list'>\n       <img id="Q" alt='white queen' class="piece promoting-piece" src=${t.Q}>\n       <img id="R" alt='white rook' class="piece promoting-piece" src=${t.R}>\n       <img id="B" alt='white bishop' class="piece promoting-piece" src=${t.B}>\n       <img id="N" alt='white knight' class="piece promoting-piece" src=${t.N}>\n     </div>`,r=`<div class='promotion-list'>\n      <img id="n" alt='black knight' class="piece promoting-piece" src=${t.n}>\n      <img id="b" alt='black bishop' class="piece promoting-piece" src=${t.b}>\n      <img id="r" alt='black rook' class="piece promoting-piece" src=${t.r}>\n      <img id="q" alt='black queen' class="piece promoting-piece" src=${t.q}>\n     </div>`,e=document.createElement("div");return"8"===i?(e.innerHTML=s,e.firstElementChild):"1"===i?(e.innerHTML=r,e.firstElementChild):void 0})(n);return"P"===o?h.replaceChild(u,i):c.replaceChild(u,l),void u.addEventListener("click",(s=>{const t=s.target;t.classList.remove("promoting-piece"),t.setAttribute("draggable","true"),t.addEventListener("dragstart",(()=>{k(t)})),t.addEventListener("dragend",(()=>{V(t)})),i.innerHTML="",i.appendChild(t),"P"===o?h.replaceChild(i,u):c.replaceChild(l,u),r.PromotePawn(t.id),r.IsPromoting=!1}))}return i.innerHTML="",i.appendChild(e),void e.classList.remove("dragging")}e.parentElement.id!==i.id&&e.classList.remove("dragging")},x=class{constructor(s){i(this,s),this.validator=new v,this.light="#E0C35A",this.dark="#7A6A31"}componentDidLoad(){this.analysisBoardContainer.innerHTML=e(this.light,this.dark,"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR");const i=this.analysisBoardContainer.querySelectorAll(".piece"),s=this.analysisBoardContainer.querySelectorAll(".square");i.forEach((i=>{i.addEventListener("dragstart",(()=>{k(i)})),i.addEventListener("dragend",(()=>{V(i)})),i.addEventListener("click",(()=>{((i,s,t)=>{if(i.classList.contains("dragging"))return void i.classList.remove("dragging");const r=s.querySelector(".dragging");null===r?i.classList.add("dragging"):q(r.parentElement,s,t)})(i,this.analysisBoardContainer,this.validator)}))})),s.forEach((i=>{i.addEventListener("dragover",(i=>{i.preventDefault()})),i.addEventListener("drop",(s=>{s.preventDefault(),q(i,this.analysisBoardContainer,this.validator)})),i.addEventListener("click",(()=>{null!==this.analysisBoardContainer.querySelector(".dragging")&&q(i,this.analysisBoardContainer,this.validator)}))}))}render(){return s("div",{ref:i=>this.analysisBoardContainer=i,id:"analysis-board-container"})}};x.style="#analysis-board-container{position:relative;width:400px;height:400px;border:1px solid black}.row{display:flex;flex-direction:row;width:100%;height:50px}.promotion-list{display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;height:210px;width:55px}.square{width:50px;height:50px;border:0.1px black}.list-squares{width:50px;height:50px;border:0.1px black;background-color:lightgray}.piece{display:flex;justify-content:center;align-items:center;touch-action:none;cursor:grab;cursor:move}.promoting-piece{background-color:gray}.piece:active{cursor:grabbing}.dragging{transform:scale(1.2);transition:0.2s ease-in-out}.invisible{display:none}@media (max-width: 550px){#analysis-board-container{width:360px;height:360px}.row{height:45px}.square{width:45px;height:45px}.piece{height:40px}}";export{x as analysis_board}