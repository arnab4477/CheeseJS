import{r as i,h as s}from"./p-4d97f5d8.js";import{f as t,g as r}from"./p-354f5047.js";import"./p-5a92e793.js";const e=(i,s,t,r,e)=>{let n="",a="",o="";if(i===s&&t===r)return{square:i+t,piece:a,color:o};let h=i.charCodeAt(0),l=s.charCodeAt(0),p=parseInt(t),d=parseInt(r),g=h+1,u=h-1,f=p+1,b=p-1;const P="h".charCodeAt(0),m="a".charCodeAt(0);if(l>h&&d>p)for(;(g<=l&&g<=P||f<=d&&f<=8)&&(n=String.fromCharCode(g)+f.toString(),a=e[n[0]][n[1]],o=c(a),""===a);)g++,f++;else if(l>h&&d<p)for(;(g<=l&&g<=P||b>=d&&b>=1)&&(n=String.fromCharCode(g)+b.toString(),a=e[n[0]][n[1]],o=c(a),""===a);)g++,b--;else if(l<h&&d>p)for(;(u>=l&&u>=m||f<=d&&f<=8)&&(n=String.fromCharCode(u)+f.toString(),a=e[n[0]][n[1]],o=c(a),""===a);)u--,f++;else if(l<h&&d<p)for(;(u>=l&&u>=m||b>=d&&b>=1)&&(n=String.fromCharCode(u)+b.toString(),a=e[n[0]][n[1]],o=c(a),""===a);)u--,b--;return{square:n,piece:a,color:o}},n=(i,s,t,r)=>{let e="",n="",a="";if(i===s)return{square:t+i,piece:n,color:a};const o=parseInt(i),h=parseInt(s);let l=o+1,p=o-1;if(o<h)for(;l<=h&&(e=t+l.toString(),n=r[e[0]][e[1]],a=c(n),""===n);l++);else for(;p>=h&&(e=t+p.toString(),n=r[e[0]][e[1]],a=c(n),""===n);p--);return{square:e,piece:n,color:a}},a=(i,s,t,r)=>{let e="",n="",a="";if(i===s&&r)return{square:i+t,piece:n,color:a};let o=i.charCodeAt(0),h=s.charCodeAt(0),l=o+1,p=o-1;if(o<h)for(;l<=h&&(e=String.fromCharCode(l)+t,n=r[e[0]][e[1]],a=c(n),""===n);l++);else for(;p>=h&&(e=String.fromCharCode(p)+t,n=r[e[0]][e[1]],a=c(n),""===n);p--);return{square:e,piece:n,color:a}},o=(i,s)=>{const[t,r,e,n]=p(i,s),[a,o]=d(t,r,e,n);if(a===o&&1===a)return!0;if(t===e){if(1===Math.abs(parseInt(r)-parseInt(n)))return!0}else if(r===n&&1===Math.abs(t.charCodeAt(0)-e.charCodeAt(0)))return!0;return!1},h=(i,s,t,r,e)=>!!(t!==s&&("w"===s&&e.includes(i)||"b"===s&&r.includes(i))),l=(i,s,t,r)=>{const[e,n,a,o]=p(s,t);let h=JSON.parse(JSON.stringify(r));return h[e][n]="",h[a][o]=i,h},c=i=>""===i?"":i.toLowerCase()===i?"b":"w",p=(i,s)=>{const[t,r]=g(i),[e,n]=g(s);return[t,r,e,n]},d=(i,s,t,r)=>[Math.abs(i.charCodeAt(0)-t.charCodeAt(0)),Math.abs(parseInt(s)-parseInt(r))],g=i=>2!==i.length&&"number"!=typeof parseInt(i[1])?(console.error("Invalid square given"),[null,null]):[i[0],i[1]],u=(i,s,t,r,e)=>{let a=!1,l={square:"",piece:"",color:""};return"up"===r?l=n(s,"8",i,e):"down"===r&&(l=n(s,"1",i,e),"w"===t&&"K"===l.piece&&(l=n((parseInt(s)-2).toString(),"1",i,e)),"b"===t&&"k"===l.piece&&(l=n((parseInt(s)-2).toString(),"1",i,e))),!(!o(i+s,l.square)||(a=h(l.piece,t,l.color,["Q","R","K"],["q","r","k"]),!a))||(a=h(l.piece,t,l.color,["Q","R"],["q","r"]),!!a)},f=(i,s,t,r,e)=>{let n=!1,l={square:"",piece:"",color:""};return"left"===r?l=a(i,"a",s,e):"right"===r&&(l=a(i,"h",s,e)),!(!o(i+s,l.square)||(n=h(l.piece,t,l.color,["Q","R","K"],["q","r","k"]),!n))||(n=h(l.piece,t,l.color,["Q","R"],["q","r"]),!!n)},b=(i,s,t)=>s>8||s<1||i>"h".charCodeAt(0)||i<"a".charCodeAt(0)?"":t[String.fromCharCode(i)][s.toString()],P=(i,s,t,r,n)=>{let[a,l]=((i,s)=>{const[t,r]=g(i);let e=t.charCodeAt(0),n=parseInt(r);const a="h".charCodeAt(0),o="a".charCodeAt(0);if("right-up"===s)for(;e<a&&n<8;)e++,n++;else if("right-down"===s)for(;e<a&&n>1;)e++,n--;else if("left-up"===s)for(;e>o&&n<8;)e--,n++;else if("left-down"===s)for(;e>o&&n>1;)e--,n--;return[String.fromCharCode(e),n.toFixed()]})(i+s,r),c=!1,p={square:"",piece:"",color:""};if(p=e(i,a,s,l,n),o(i+s,p.square)){if(((i,s,t)=>"w"===i&&"p"===s&&("right-up"===t||"left-up"===t)||"b"===i&&"P"===s&&("right-down"===t||"left-down"===t))(t,p.piece,r))return!0;if(c=h(p.piece,t,p.color,["Q","B","K"],["q","b","k"]),c)return!0}return c=h(p.piece,t,p.color,["Q","B"],["q","b"]),!!c},m=(i,s,t)=>{const[r,e]=g(i);return!!(u(r,e,s,"up",t)||u(r,e,s,"down",t)||f(r,e,s,"right",t)||f(r,e,s,"left",t)||P(r,e,s,"right-up",t)||P(r,e,s,"right-down",t)||P(r,e,s,"left-up",t)||P(r,e,s,"left-down",t)||((i,s,t,r)=>{const e=i.charCodeAt(0),n=parseInt(s);return"w"===t?"n"===b(e+1,n+2,r)||"n"===b(e-1,n+2,r)||"n"===b(e+1,n-2,r)||"n"===b(e-1,n-2,r)||"n"===b(e+2,n+1,r)||"n"===b(e-2,n+1,r)||"n"===b(e+2,n-1,r)||"n"===b(e-2,n-1,r):"b"===t?"N"===b(e+1,n+2,r)||"N"===b(e-1,n+2,r)||"N"===b(e+1,n-2,r)||"N"===b(e-1,n-2,r)||"N"===b(e+2,n+1,r)||"N"===b(e-2,n+1,r)||"N"===b(e+2,n-1,r)||"N"===b(e-2,n-1,r):void 0})(r,e,s,t))};class w{constructor(){this.boardMap=t(),this.whitesTurn=!0,this.movingPiece="",this.movingPiecesOrigin="",this.movingPiecesDest="",this.movingPiecesColor="",this.canWhiteEnPassant=[!1,""],this.canBlackEnPassant=[!1,""],this.canWhiteCastleKingSide=!0,this.canWhiteCastleQueenSide=!0,this.canBlackCastleKingSide=!0,this.canBlackCastleQueenSide=!0,this.IsPromoting=!1,this.whiteKingsPosition="e1",this.blackKingsPosition="e8"}PromotePawn(i){const s=l(i,this.movingPiecesOrigin,this.movingPiecesDest,this.boardMap);this.boardMap=JSON.parse(JSON.stringify(s)),this.whitesTurn=!this.whitesTurn}newMove(){const i=l(this.movingPiece,this.movingPiecesOrigin,this.movingPiecesDest,this.boardMap);this.boardMap=JSON.parse(JSON.stringify(i)),this.whitesTurn=!this.whitesTurn}ValidateMove(i,s,t){let r=!1,e=!1,n=!1,a=!1;if(i===s)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};let o=this.movingPiecesColor;if(this.movingPiecesColor=c(t),this.whitesTurn&&"w"!==this.movingPiecesColor)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};if(!this.whitesTurn&&"b"!==this.movingPiecesColor)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};if(this.IsPromoting)return{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a};switch(t){case"K":({isValid:r,isCastle:n}=this.validateKingMove(i,s,"w"));break;case"k":({isValid:r,isCastle:n}=this.validateKingMove(i,s,"b"));break;case"Q":r=this.validateQueenMove(i,s,"w");break;case"q":r=this.validateQueenMove(i,s,"b");break;case"R":r=this.validateRookMove(i,s,"w");break;case"r":r=this.validateRookMove(i,s,"b");break;case"B":r=this.validateBishopMove(i,s,"w");break;case"b":r=this.validateBishopMove(i,s,"b");break;case"N":r=this.validateKnightMove(i,s,"w");break;case"n":r=this.validateKnightMove(i,s,"b");break;case"P":({isValid:r,isEnPassant:e,isPromotion:a}=this.validatePawnMove(i,s,"w"));break;case"p":({isValid:r,isEnPassant:e,isPromotion:a}=this.validatePawnMove(i,s,"b"))}if(r){"K"===t?(this.whiteKingsPosition=s,this.canWhiteCastleKingSide=!1,this.canWhiteCastleQueenSide=!1):"k"===t&&(this.blackKingsPosition=s,this.canBlackCastleKingSide=!1,this.canBlackCastleQueenSide=!1);const o=JSON.parse(JSON.stringify(this.boardMap));return((i,s,t,r,e,n)=>{const a=l(i,s,t,n),o=c(i);return"w"===o?!m(r,"w",a):"b"===o?!m(e,"b",a):void 0})(t,i,s,this.whiteKingsPosition,this.blackKingsPosition,o)?n?("K"===t?(this.boardMap.e[1]="","g1"===s||"h1"===s?(this.boardMap.g[1]="K",this.boardMap.f[1]="R",this.boardMap.h[1]=""):"c1"!==s&&"a1"!==s||(this.boardMap.c[1]="K",this.boardMap.d[1]="R",this.boardMap.a[1]="")):"k"===t&&(this.boardMap.e[8]="","g8"===s||"h8"===s?(this.boardMap.g[8]="k",this.boardMap.f[8]="r",this.boardMap.h[8]=""):"c8"!==s&&"a8"!==s||(this.boardMap.c[8]="k",this.boardMap.d[8]="r",this.boardMap.a[8]="")),this.whitesTurn=!this.whitesTurn,{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a}):(a||(e&&("P"===t?this.boardMap[s[0]][(parseInt(s[1])-1).toString()]="":"p"===t&&(this.boardMap[s[0]][(parseInt(s[1])+1).toString()]="")),"P"!==t&&"p"!==t&&(this.canBlackEnPassant=[!1,""],this.canWhiteEnPassant=[!1,""]),this.movingPiece=t,this.movingPiecesOrigin=i,this.movingPiecesDest=s,this.newMove()),{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a}):{isValid:!1,isEnPassant:e,isCastle:n,isPromotion:a}}return this.movingPiecesColor=o,{isValid:r,isEnPassant:e,isCastle:n,isPromotion:a}}validatePawnMove(i,s,t){const r=p(i,s);let e=!1,a=!1,o=!1;if(r.includes(null))return console.log("invalid square input"),{isValid:e,isEnPassant:a,isPromotion:o};const[h,l,g,u]=r,[f,b]=d(h,l,g,u);if(f>1||b>2)return{isValid:e,isEnPassant:a,isPromotion:o};let P="";if(a=((i,s,t,r,e)=>"w"===r?"5"===s&&"6"===t&&"p"===e[i][s]:"b"===r?"4"===s&&"3"===t&&"P"===e[i][s]:void 0)(g,l,u,t,this.boardMap),o=((i,s)=>("8"===s||"1"===s)&&("w"===i&&"8"===s||"b"===i&&"1"===s))(t,u),"w"===t){if(2===b&&"2"!==l)return{isValid:e,isEnPassant:a,isPromotion:o};if(!(parseInt(u)>parseInt(l)))return{isValid:e,isEnPassant:a,isPromotion:o};if(f===b)return a&&this.canWhiteEnPassant[0]&&""===this.boardMap[g][u]&&g===this.canWhiteEnPassant[1]?(this.canWhiteEnPassant=[!1,""],e=!0,{isValid:e,isEnPassant:a,isPromotion:o}):"b"===c(this.boardMap[g][u])?(e=!0,{isValid:e,isEnPassant:a,isPromotion:o}):{isValid:e,isEnPassant:a,isPromotion:o};if(P=n(l,u,h,this.boardMap).color,""!==P)return{isValid:e,isEnPassant:a,isPromotion:o}}else if("b"===t){if(2===b&&"7"!==l)return{isValid:e,isEnPassant:a,isPromotion:o};if(!(parseInt(u)<parseInt(l)))return{isValid:e,isEnPassant:a,isPromotion:o};if(f===b)return a&&this.canBlackEnPassant[0]&&""===this.boardMap[g][u]&&g===this.canBlackEnPassant[1]?(this.canBlackEnPassant=[!1,""],e=!0,{isValid:e,isEnPassant:a,isPromotion:o}):"w"===c(this.boardMap[g][u])?(e=!0,{isValid:e,isEnPassant:a,isPromotion:o}):{isValid:e,isEnPassant:a,isPromotion:o};if(P=n(l,u,h,this.boardMap).color,""!==P)return{isValid:e,isEnPassant:a,isPromotion:o}}return 2===b?"w"===t?this.canBlackEnPassant=[!0,h]:"b"===t&&(this.canWhiteEnPassant=[!0,h]):(this.canWhiteEnPassant=[!1,""],this.canBlackEnPassant=[!1,""]),e=!0,{isValid:e,isEnPassant:a,isPromotion:o}}validateKnightMove(i,s,t){const r=p(i,s);if(r.includes(null))return console.log("invalid square input"),!1;const[e,n,a,o]=r,[h,l]=d(e,n,a,o);return(1===h&&2===l||2===h&&1===l)&&t!==c(this.boardMap[a][o])}validateQueenMove(i,s,t){const r=this.validateRookMove(i,s,t),e=this.validateBishopMove(i,s,t);return!(!r&&!e)}validateKingMove(i,s,t){let r=!1;const e=p(i,s),[n,a,o,h]=e,[l,c]=d(n,a,o,h),g=((i,s,t,r,e,n,a,o)=>{if("w"===t){if("e1"!==i||"g1"!==s&&"h1"!==s&&"c1"!==s&&"a1"!==s||"R"!==r.h[1]&&"R"!==r.a[1])return!1;if("g1"===s||"h1"===s){if(!this.canWhiteCastleKingSide)return!1;if(""!==r.f[1]||""!==r.g[1])return!1;const i=m("f1","w",r),s=m("g1","w",r);return!i&&!s}if("c1"===s||"a1"===s){if(!n)return!1;if(""!==r.d[1]||""!==r.c[1])return!1;const i=m("d1","w",r),s=m("c1","w",r);return!i&&!s}}else if("b"===t){if("e8"!==i||"g8"!==s&&"h8"!==s&&"c8"!==s&&"a8"!==s||"r"!==r.h[8]&&"r"!==r.a[8])return!1;if("g8"===s||"h8"===s){if(!a)return!1;if(""!==r.f[8]||""!==r.g[8])return!1;const i=m("f8","b",r),s=m("g8","b",r);return!i&&!s}if("c8"===s||"a8"===s){if(!o)return!1;if(""!==r.d[8]||""!==r.c[8])return!1;const i=m("d8","b",r),s=m("c8","b",r);return!i&&!s}}})(i,s,t,this.boardMap,0,this.canWhiteCastleQueenSide,this.canBlackCastleKingSide,this.canBlackCastleQueenSide);return c>1?{isValid:r,isCastle:g}:l>1?g?(r=!0,{isValid:r,isCastle:g}):{isValid:r,isCastle:g}:(r=this.validateQueenMove(i,s,t),r&&m(s,t,this.boardMap)?(r=!1,{isValid:r,isCastle:g}):{isValid:r,isCastle:g})}validateBishopMove(i,s,t){const r=p(i,s);if(r.includes(null))return console.log("invalid square input"),!1;const[n,a,o,h]=r,[l,c]=d(n,a,o,h);if(l!==c)return!1;const g=e(n,o,a,h,this.boardMap);return t!==g.color&&(""===g.color||g.color===t||g.square===s)}validateRookMove(i,s,t){const r=p(i,s);if(r.includes(null))return console.log("invalid square input"),!1;const[e,o,h,l]=r;if(e!==h&&o!==l)return!1;if(o===l){const i=a(e,h,o,this.boardMap);if(t===i.color)return!1;if(""!==i.color&&i.color!==t&&i.square!==s)return!1}else if(e===h){const i=n(o,l,e,this.boardMap);if(t===i.color)return!1;if(""!==i.color&&i.color!==t&&i.square!==s)return!1}return"a1"===i&&(this.canWhiteCastleQueenSide=!1),"h1"===i&&(this.canWhiteCastleKingSide=!1),"a8"===i&&(this.canBlackCastleQueenSide=!1),"h8"===i&&(this.canBlackCastleKingSide=!1),!0}}const v=i=>{setTimeout((()=>{i.classList.add("dragging","invisible")}),0)},k=i=>{i.classList.remove("dragging","invisible")},V=(i,s,t)=>{const r=s.querySelector(".dragging"),e=r.parentElement.id,n=i.id,a=r.id,{isValid:o,isEnPassant:h,isCastle:l,isPromotion:p}=t.ValidateMove(e,n,a);if(o){if(h)return((i,s,t)=>{if("w"===c(s)){const s=i[0]+(parseInt(i[1])-1).toString();return t.querySelector(`#${s}`)}if("b"===c(s)){const s=i[0]+(parseInt(i[1])+1).toString();return t.querySelector(`#${s}`)}})(n,a,s).innerHTML="",i.appendChild(r),void r.classList.remove("dragging");if(l&&("K"===a||"k"===a)){const[i,t,e,o]=((i,s,t)=>{let r,e,n,a;return"K"===i?(r=t.querySelector("#e1"),"g1"===s||"h1"===s?(e=t.querySelector("#g1"),n=t.querySelector("#h1"),a=t.querySelector("#f1")):"c1"!==s&&"a1"!==s||(e=t.querySelector("#c1"),n=t.querySelector("#a1"),a=t.querySelector("#d1"))):"k"===i&&(r=t.querySelector("#e8"),"g8"===s||"h8"===s?(e=t.querySelector("#g8"),n=t.querySelector("#h8"),a=t.querySelector("#f8")):"c8"!==s&&"a8"!==s||(e=t.querySelector("#c8"),n=t.querySelector("#a8"),a=t.querySelector("#d8"))),[r,e,n,a]})(a,n,s);i.innerHTML="",t.appendChild(r);const h=e.firstElementChild;return e.innerHTML="",o.appendChild(h),void r.classList.remove("dragging")}if(p){t.IsPromoting=!0,r.remove();const e=n[1],o=i.parentElement;let h,l,c="";"p"===a&&(c=(parseInt(n[1])+3).toString(),h=s.querySelector(`#${n[0]+c}`),l=h.parentElement);const p=(i=>{const s=document.createElement("div");return"8"===i?(s.innerHTML='<div class=\'promotion-list\'>\n       <img id="Q" alt=\'white queen\' class="piece promoting-piece" src=../assets/WQ.svg.png>\n       <img id="R" alt=\'white rook\' class="piece promoting-piece" src=../assets/WR.svg.png>\n       <img id="B" alt=\'white bishop\' class="piece promoting-piece" src=../assets/WB.svg.png>\n       <img id="N" alt=\'white knight\' class="piece promoting-piece" src=../assets/WN.svg.png>\n     </div>',s.firstElementChild):"1"===i?(s.innerHTML='<div class=\'promotion-list\'>\n      <img id="n" alt=\'black knight\' class="piece promoting-piece" src=../assets/bn.svg.png>\n      <img id="b" alt=\'black bishop\' class="piece promoting-piece" src=../assets/bb.svg.png>\n      <img id="r" alt=\'black rook\' class="piece promoting-piece" src=../assets/br.svg.png>\n      <img id="q" alt=\'black queen\' class="piece promoting-piece" src=../assets/bq.svg.png>\n     </div>',s.firstElementChild):void 0})(e);return"P"===a?o.replaceChild(p,i):l.replaceChild(p,h),void p.addEventListener("click",(s=>{const r=s.target;r.classList.remove("promoting-piece"),r.setAttribute("draggable","true"),r.addEventListener("dragstart",(()=>{v(r)})),r.addEventListener("dragend",(()=>{k(r)})),i.innerHTML="",i.appendChild(r),"P"===a?o.replaceChild(i,p):l.replaceChild(h,p),t.PromotePawn(r.id),t.IsPromoting=!1}))}return i.innerHTML="",i.appendChild(r),void r.classList.remove("dragging")}r.parentElement.id!==i.id&&r.classList.remove("dragging")},q=class{constructor(s){i(this,s),this.validator=new w,this.light="#E0C35A",this.dark="#7A6A31"}componentDidLoad(){this.analysisBoardContainer.innerHTML=r(this.light,this.dark,"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR");const i=this.analysisBoardContainer.querySelectorAll(".piece"),s=this.analysisBoardContainer.querySelectorAll(".square");i.forEach((i=>{i.addEventListener("dragstart",(()=>{v(i)})),i.addEventListener("dragend",(()=>{k(i)})),i.addEventListener("click",(()=>{if(i.classList.contains("dragging"))return void i.classList.remove("dragging");const s=this.analysisBoardContainer.querySelector(".dragging");null===s?i.classList.add("dragging"):V(s.parentElement,this.analysisBoardContainer,this.validator)}))})),s.forEach((i=>{i.addEventListener("dragover",(i=>{i.preventDefault()})),i.addEventListener("drop",(s=>{s.preventDefault(),V(i,this.analysisBoardContainer,this.validator)})),i.addEventListener("click",(()=>{null!==this.analysisBoardContainer.querySelector(".dragging")&&V(i,this.analysisBoardContainer,this.validator)}))}))}render(){return s("div",{ref:i=>this.analysisBoardContainer=i,id:"analysis-board-container"})}};q.style="#analysis-board-container{position:relative;width:400px;height:400px;border:1px solid black}.row{display:flex;flex-direction:row;width:100%;height:50px}.promotion-list{display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;height:200px;width:50px}.square{width:50px;height:50px;border:0.1px black}.list-squares{width:50px;height:50px;border:0.1px black;background-color:lightgray}.piece{display:flex;justify-content:center;align-items:center;touch-action:none;cursor:grab;cursor:move}.promoting-piece{background-color:gray}.piece:active{cursor:grabbing}.dragging{transform:scale(1.2);transition:0.2s ease-in-out}.invisible{display:none}@media (max-width: 550px){#analysis-board-container{width:360px;height:360px}.row{height:45px}.square{width:45px;height:45px}.piece{height:40px}}";export{q as analysis_board}